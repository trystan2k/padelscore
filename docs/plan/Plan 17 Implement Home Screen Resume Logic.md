## Task Analysis
- Main objective: Implement Task 17 so Home uses schema persistence (`loadMatchState`) to decide Resume visibility, resumes only active sessions, restores runtime manager state before navigation, and preserves exact Game Screen state on resume while failing safely for invalid/corrupt data.
- Identified dependencies: Task 12 persistence API (`utils/match-storage.js`), runtime manager pattern in `app.js` (`globalData.matchState` + `globalData.matchHistory`), Home lifecycle/render flow in `page/index.js`, Game session guard/hydration in `page/game.js`, score rendering in `page/score-view-model.js`, and existing integration harnesses in `tests/home-screen.test.js` and `tests/game-screen-layout.test.js`.
- System impact: Medium-high on Home resume flow and state hydration contracts, medium on Game restoration completeness (especially persisted current-game points -> runtime points), medium on test suite updates, low on unrelated UI/layout flows.

## Chosen Approach
- Proposed solution: Use a schema-first resume gate in `page/index.js` (async `loadMatchState` on init/show, Resume visible only for `status === 'active'`), re-load and validate on Resume click, hydrate `app.globalData.matchState` with a normalized runtime snapshot, reset history stack, then navigate to `page/game`; tighten Game hydration so restored current-game points/set metadata render exactly from manager + persisted session.
- Justification for simplicity: Deepthink + brainstorming compared (A) full runtime/schema unification and removal of legacy storage now (rejected as overengineered and high-risk for current task), (B) minimal Home-only button toggle without robust hydration updates (rejected as insufficient for exact state restoration), and (C) targeted Home schema-first migration plus focused Game hydration/tests (chosen). Option C is the smallest change set that meets all acceptance criteria and aligns with current architecture.
- Components to be modified/created: `page/index.js`, `page/game.js` (hydration completeness and safe restore path), `tests/home-screen.test.js`, `tests/game-screen-layout.test.js` (resume restoration assertions), and `docs/match-state-integration.md` (resume behavior + error-handling notes).

## Implementation Steps
1. Validate assumptions and boundaries before code changes: confirm Task 17.1-17.6 scope, confirm runtime manager remains `app.globalData.matchState/matchHistory`, confirm non-goals (no Summary implementation changes from Task 18, no broad storage migration), and lock acceptance mapping for active/null/finished/corrupt session scenarios.
2. Implement Home init/show schema check (Task 17.2): refactor `page/index.js` refresh logic to call `loadMatchState()` during `onInit` and `onShow`, derive `hasSavedGame` strictly from `saved && saved.status === 'active'`, keep Resume hidden for null/finished/invalid values, and guard async lifecycle races so stale responses do not re-enable Resume after state changes.
3. Implement Resume click reload + runtime restore (Tasks 17.3 and 17.4): in `handleResumeGame`, re-fetch with `loadMatchState()` (do not trust stale cache), validate active session, normalize persisted schema fields into runtime shape, write into global manager, clear/reinitialize history stack, and only then navigate to `page/game`; on load/validation failure, fail safe (no crash, no navigation, Resume hidden on next render).
4. Complete Game restoration fidelity (Task 17.5): adjust Game hydration path so restored runtime state renders exact persisted context (current game points, set games/number, sets won, status/winner metadata, team labels) from manager + persisted session, including numeric persisted points conversion into runtime point representation where needed. Elevated risk: point-value conversion mismatches causing incorrect mid-game score display; mitigation: keep conversion in one helper with deterministic tests for 0/15/30/40/Ad/Game equivalents; rollback: temporarily defer to prior runtime points source while keeping Resume gating and safe-failure behavior intact.
5. Expand Home tests for resume logic and safety (Tasks 17.2-17.4, 17.6): update `tests/home-screen.test.js` to assert `loadMatchState`-driven behavior (active shows Resume; null/finished/invalid/corrupt/load-error hides Resume), assert Resume click restores manager state and navigates only on valid active data, and assert failed reload does not crash or navigate.
6. Expand Game integration tests for restored state rendering (Tasks 17.5-17.6): add/adjust cases in `tests/game-screen-layout.test.js` to verify Game renders restored set counters, game points, and status from resumed manager state; include regression case that finished sessions do not pass access guard from Home resume flow.
7. Update documentation (Task 17.6): revise `docs/match-state-integration.md` to reflect Home schema-first Resume behavior, explicit safe-failure handling for load errors/corrupt payloads, and current dual-store compatibility notes so future tasks (19/20) have accurate integration guidance.
8. Execute verification and regression gate: run focused suites first (`node --test tests/home-screen.test.js` and targeted resume cases in `tests/game-screen-layout.test.js`), then run project QA gate (`npm run test`); if regressions appear, rollback in order of risk (first revert point-conversion/hydration delta, then reassess async Home refresh race guards) while preserving active-session visibility correctness.

## Validation
- Success criteria: Home calls `loadMatchState` on init/show; Resume is visible only for valid active session and hidden for null/finished/invalid/corrupt data; Resume click restores global manager then navigates to Game; Game shows restored score/set/team context accurately; load failures never crash app; updated tests and docs capture new behavior.
- Checkpoints: Pre-implementation checkpoint (after Step 1) verifies assumptions, non-goals, and acceptance mapping; implementation checkpoint A (after Steps 2-3) verifies Home visibility and resume navigation guards with focused Home tests; implementation checkpoint B (after Step 4) verifies exact restored scoring/set rendering with targeted Game tests; post-implementation checkpoint (after Steps 5-8) requires passing focused tests, full `npm run test`, and documentation update review. Rollback trigger: if any checkpoint fails due to hydration conversion regressions, revert conversion helper changes first and keep schema-driven Resume safety path in place.
